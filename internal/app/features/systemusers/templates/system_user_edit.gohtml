{{ define "system_user_edit" }}
  {{ template "layout" . }}
{{ end }}

{{ define "content" }}
<div class="flex items-center mb-2">
  <a href="{{ .BackURL }}"
     class="text-sm px-3 py-1 border rounded hover:bg-gray-50 mr-2"
     title="Go back">
    â† Back
  </a>
  <h1 class="text-2xl font-bold text-gray-900">ğŸ§‘â€ğŸ’» Edit System User</h1>
</div>

{{ if .Error }}
  <div class="mb-3 p-2 border border-red-300 bg-red-50 text-red-700 rounded">
    {{ .Error }}
  </div>
{{ end }}

<form method="post" action="/system-users/{{ .ID }}/edit" class="space-y-3 max-w-xl bg-white p-4 rounded border">
  <input type="hidden" name="return" value="{{ .BackURL }}">

  <div>
    <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
    <input name="full_name" type="text" value="{{ .FullName }}" class="w-full border p-2 rounded" required />
  </div>

  <div>
    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
    <input name="email" type="email" value="{{ .Email }}" class="w-full border p-2 rounded" required />
  </div>

  <div>
    <label class="block text-sm font-medium text-gray-700 mb-1">Role</label>
    <select
      name="role"
      class="w-full border p-2 rounded"
      {{ if .IsSelf }}disabled{{ end }}
    >
      <option value="admin"   {{ if eq .UserRole "admin" }}selected{{ end }}>admin</option>
      <option value="analyst" {{ if eq .UserRole "analyst" }}selected{{ end }}>analyst</option>
    </select>
    {{ if .IsSelf }}
      <p class="mt-1 text-xs text-gray-500">You canâ€™t change your own role. Ask another admin to make this change.</p>
    {{ end }}
  </div>

  <div>
    <label class="block text-sm font-medium text-gray-700 mb-1">Auth Method</label>
    <select name="auth_method" class="w-full border p-2 rounded">
      <option value="internal"  {{ if or (eq .Auth "internal")  (eq .Auth "") }}selected{{ end }}>internal</option>
      <option value="google"    {{ if eq .Auth "google" }}selected{{ end }}>google</option>
      <option value="classlink" {{ if eq .Auth "classlink" }}selected{{ end }}>classlink</option>
      <option value="clever"    {{ if eq .Auth "clever" }}selected{{ end }}>clever</option>
      <option value="microsoft" {{ if eq .Auth "microsoft" }}selected{{ end }}>microsoft</option>
    </select>
  </div>

  <div>
    <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
    <select
      name="status"
      class="w-full border p-2 rounded"
      {{ if .IsSelf }}disabled{{ end }}
    >
      <option value="active"   {{ if eq .Status "active" }}selected{{ end }}>Active</option>
      <option value="disabled" {{ if eq .Status "disabled" }}selected{{ end }}>Disabled</option>
    </select>
    {{ if .IsSelf }}
      <p class="mt-1 text-xs text-gray-500">You canâ€™t change your own status. Ask another admin to make this change.</p>
    {{ end }}
  </div>

  <div class="pt-2">
    <button class="bg-indigo-600 text-white px-3 py-1 rounded hover:bg-indigo-700">Update System User</button>
  </div>
</form>
{{ if eq .Role "admin" }}
<!-- Danger zone: Delete System User -->
<form method="post" action="/system-users/{{ .ID }}/delete" class="max-w-xl mt-4">
  <input type="hidden" name="return" value="{{ .BackURL }}">
  <button
    type="submit"
    class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700"
    onclick="return confirm('Delete this system user?');"
  >
    Delete System User
  </button>
</form>
{{ end }}
{{ end }}